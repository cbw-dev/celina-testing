<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Bioinformatics Workshops</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Manrope', 'sans-serif'], },
                    colors: {
                        // Original Brand Colors (Used for borders and color bar)
                        'brand-purple': '#5A1F65', 
                        'region-bc': '#3C9048', 
                        'region-alberta': '#86264E',
                        'region-prairies': '#BD8528', 
                        'region-ontario': '#BB682C',
                        'region-quebec': '#427FA4', 
                        'region-atlantic': '#208A99',
                        'region-online': '#5A1F65', // Same as brand-purple

                        // NEW LIGHTER REGIONAL COLORS FOR TAG BACKGROUNDS (AAA compliant with text-gray-900)
                        'region-bc-light': '#8ed792',         // CBH British Columbia light
                        'region-alberta-light': '#ca668a',    // CBH Alberta light
                        'region-prairies-light': '#f6bc6a',   // CBH Prairies light
                        'region-ontario-light': '#ffb37a',    // CBH Ontario light
                        'region-quebec-light': '#9bccf0',     // CBH Quebec light
                        'region-atlantic-light': '#84d3e1',   // CBH Atlantic light
                        'region-online-light': '#cc7ed9',     // CBW light (matching brand-purple light)
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html, body { font-family: 'Manrope', sans-serif; scroll-behavior: smooth; }
        body { background-color: #f8fafc; }
        .container { background-color: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); width: 100%; max-width: 80rem; border: 1px solid #e5e7eb; }
        .dropdown-panel, .year-section, .card { transition: all 0.3s ease-in-out; }
        .card.hidden, .year-section.hidden { opacity: 0; transform: scale(0.95); max-height: 0; overflow: hidden; margin: 0 !important; padding: 0 !important; border: none; pointer-events: none; }
        .filter-button:hover .dropdown-arrow { transform: translateY(2px); }

        /* Focus styles for keyboard navigation */
        a:focus, button:focus, input:focus, .card:focus-within {
            outline: 2px solid #5A1F65; /* Brand purple outline */
            outline-offset: 3px;
        }

        @media (max-width: 639px) {
            .carousel-on-mobile {
                display: flex;
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                gap: 1rem;
                padding: 0.5rem 1rem;
                margin: 0 -1rem;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            .carousel-on-mobile::-webkit-scrollbar {
                display: none;
            }
            .carousel-on-mobile > .card {
                flex: 0 0 80%;
                max-width: 320px;
                scroll-snap-align: start;
            }
        }
        
        .truncate-2-lines {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
    </style>
</head>

<body class="antialiased">
    <div class="container mx-auto my-8 md:my-12">
        <header class="text-center mb-12">
            <a href="https://bioinformatics.ca" target="_blank" rel="noopener noreferrer">
                <img src="img/CBW_logo.png" alt="Canadian Bioinformatics Workshops Logo - Link to Bioinformatics.ca homepage" class="mx-auto mb-6 h-40 w-auto">
            </a>
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 tracking-tight">Canadian Bioinformatics Workshops</h1>
            <!-- <p class="text-lg text-gray-500 mt-3 max-w-2xl mx-auto">Every year, the CBW offers hands-on workshops in bioinformatics. These pages contain the materials for those workshops. You can apply for upcoming workshops here:</p> -->
        </header>

        <nav aria-label="Main Navigation" class="text-center mb-12 flex justify-center items-center gap-4 md:gap-6 flex-wrap py-4">
            <a href="#about-section" class="inline-block bg-white text-brand-purple font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 shadow-lg border-2 border-brand-purple hover:bg-purple-50">About</a>
            <a href="#current-workshops-section" class="inline-block bg-white text-brand-purple font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 shadow-lg border-2 border-brand-purple hover:bg-purple-50">Upcoming Workshops</a>
            <a href="#past-workshops-section" class="inline-block bg-white text-brand-purple font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 shadow-lg border-2 border-brand-purple hover:bg-purple-50">Past Workshops</a>
            <a href="https://bioinformatics.ca/workshops/workshop-application-form/" target="_blank" rel="noopener noreferrer" class="inline-block bg-brand-purple hover:bg-purple-800 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 shadow-lg" style="background-color: #5A1F65;">Apply Now<span class="sr-only"> (opens in new tab)</span></a>
        </nav>
        
        <div id="filter-bar" role="region" aria-label="Workshop Filters" class="mb-12 flex justify-center items-center flex-wrap gap-4 p-4 bg-slate-100/70 rounded-xl">
            <div class="relative w-full sm:w-auto">
                <label for="text-search-input" class="sr-only">Search workshops by keyword</label>
                <input type="search" id="text-search-input" placeholder="Search workshops..." class="w-full sm:w-48 px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:ring-brand-purple focus:border-brand-purple transition">
            </div>
            </div>

        <main id="link-container" class="space-y-16">
            <div id="no-results-message" class="hidden" role="status" aria-live="polite">
                <div class="text-center py-12 px-6 bg-slate-50 rounded-lg">
                    <h3 class="mt-2 text-xl font-semibold text-gray-900">No workshops found</h3>
                    <p class="mt-1 text-base text-gray-500">Try adjusting your search or filter criteria.</p>
                </div>
            </div>
        </main>

        <section id="about-section" class="mt-20 pt-16 border-t border-gray-200">
             <h2 class="text-3xl md:text-4xl font-extrabold text-gray-800 tracking-tight text-center">About The Canadian Bioinformatics Workshops</h2>
             <div class="max-w-4xl mx-auto mt-8 text-lg text-gray-600 space-y-6 text-left"><p>The Canadian Bioinformatics Workshops (CBW) series was initiated in 1999 by the Canadian Genetic Diseases Network as a forum for graduate students and other researchers to learn about new tools and techniques in bioinformatics. The series has been a great success, with over 5,000 trainees attending workshops since its inception.</p></div>
        </section>
    </div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    try {
        const response = await fetch('workshops.json');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const linksData = await response.json();
        const regionOrder = ['BC', 'Alberta', 'Prairies', 'Ontario', 'Quebec', 'Atlantic', 'Online'];
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const linkContainer = document.getElementById('link-container');
        const noResultsMessage = document.getElementById('no-results-message');
        const searchInput = document.getElementById('text-search-input');
        const filterBar = document.getElementById('filter-bar');
        
        const allFilters = {
            year: { container: null, active: new Set(), label: "Year" },
            regions: { container: null, active: new Set(), label: "Region" },
            title: { container: null, active: new Set(), label: "Workshop" },
            tags: { container: null, active: new Set(), label: "Topics" },
            format: { container: null, active: new Set(), label: "Format" },
            status: { container: null, active: new Set(), label: "Status" }
        };

        function formatDateRange(startDateStr, endDateStr) {
            const start = new Date(startDateStr + 'T00:00:00');
            const end = new Date(endDateStr + 'T00:00:00');
            const startMonth = start.toLocaleString('en-US', { month: 'long' });
            const startDay = start.getDate();
            const year = start.getFullYear();
            if (!endDateStr || startDateStr === endDateStr) return `${startMonth} ${startDay}, ${year}`;
            const endMonth = end.toLocaleString('en-US', { month: 'long' });
            const endDay = end.getDate();
            if (startMonth === endMonth) return `${startMonth} ${startDay}-${endDay}, ${year}`;
            return `${startMonth} ${startDay} - ${endMonth} ${endDay}, ${year}`;
        }

        function createCardElement(link) {
            // Use <article> for independent content blocks
            const card = document.createElement('article');
            card.className = `card flex flex-col bg-white rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-1 transition-all duration-300 ease-in-out hover:shadow-xl`;
            // Add tabindex for keyboard navigation if cards are interactive beyond links
            card.setAttribute('tabindex', '0'); 
            card.setAttribute('role', 'group'); // Indicate it's a group of related elements

            card.dataset.year = JSON.stringify([link.year]);
            card.dataset.title = JSON.stringify([link.title]);
            card.dataset.tags = JSON.stringify(link.tags);
            card.dataset.regions = JSON.stringify(link.regions);
            card.dataset.format = JSON.stringify([link.format]);
            card.dataset.search = (
                link.title + ' ' + 
                link.tags.join(' ') + ' ' + 
                (link.locations || []).join(' ') + ' ' +
                (link.instructors || []).join(' ')
            ).toLowerCase();

            const workshopStartDate = new Date(link.startDate + 'T00:00:00');
            const workshopEndDate = new Date(link.endDate + 'T00:00:00');
            
            let statusFlagHTML = '';
            let statusTags = [];

            // Updated colors for status flags (AAA compliant)
            if (workshopStartDate <= today && today <= workshopEndDate) {
                statusFlagHTML = `<div class="flex items-center justify-center bg-green-700 text-white text-xs font-bold uppercase px-3 py-1 rounded-full shadow-lg" role="status">Happening Now</div>`;
                statusTags = ["Happening Now"];
            } else if (workshopStartDate > today) {
                statusFlagHTML = `<div class="flex items-center justify-center bg-orange-400 text-gray-900 text-xs font-bold uppercase px-3 py-1 rounded-full shadow-lg" role="status">Upcoming</div>`;
                statusTags = ["Upcoming"];
            } else {
                 statusTags = ["Past"];
            }
            card.dataset.status = JSON.stringify(statusTags);
            
            const sortedRegions = [...link.regions].sort((a,b) => regionOrder.indexOf(a) - regionOrder.indexOf(b));
            
            // Regional tag styling: light background, darker border, dark text
            const regionTagsHTML = sortedRegions.map(region => {
                const borderClass = `border-region-${region.toLowerCase().replace(' ', '-')}`; // Original darker color for border
                const lightBgClass = `bg-region-${region.toLowerCase().replace(' ', '-')}-light`; // New lighter color for background
                return `<span class="flex items-center justify-center ${lightBgClass} text-gray-900 border-2 ${borderClass} rounded-full px-3 py-1 text-xs font-bold shadow-sm" title="Region: ${region}">${region}</span>`;
            }).join('');

            const regionColors = sortedRegions.map(region => tailwind.config.theme.extend.colors[`region-${region.toLowerCase()}`]).filter(Boolean);
            let colorBarHTML = '<div class="h-1.5 bg-gray-300"><span class="sr-only">Workshop regions color bar</span></div>'; // Added sr-only
            if (regionColors.length > 1) {
                colorBarHTML = `<div class="h-1.5" style="background-image: linear-gradient(to right, ${regionColors.join(', ')})"><span class="sr-only">Workshop regions color bar</span></div>`; // Added sr-only
            } else if (regionColors.length === 1) {
                colorBarHTML = `<div class="h-1.5" style="background-color: ${regionColors[0]}"><span class="sr-only">Workshop region: ${sortedRegions[0]}</span></div>`; // Added sr-only
            }
            
            const locationsHTML = (link.locations || []).map(loc => `
                <div class="flex items-center text-sm text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-400 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    <span class="font-medium">${loc}</span>
                </div>
            `).join('');

            card.innerHTML = `
                ${colorBarHTML}
                <div class="relative">
                    <a href="${link.url}" target="_blank" rel="noopener noreferrer">
                        <img loading="lazy" class="w-full h-48 object-cover" src="${link.image}" alt="Image for ${link.title} workshop" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=800';">
                    </a>
                    
                    <div class="absolute top-3 right-3 z-10"> <div class="flex flex-wrap justify-end gap-2 max-w-[calc(100% - 6rem)]"> ${regionTagsHTML}
                        </div>
                    </div>

                    <div class="absolute bottom-3 left-3 z-10"> 
                        ${statusFlagHTML}
                    </div>
                </div>
                <div class="p-5 flex flex-col flex-grow">
                    <div class="min-h-16">
                        <h3 class="text-lg font-bold text-gray-800 truncate-2-lines">
                            <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="hover:text-brand-purple transition-colors">${link.title}<span class="sr-only"> (opens in new tab)</span></a>
                        </h3>
                    </div>
                    <div class="space-y-2 mt-3">
                        <div class="flex items-center text-sm text-gray-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-400 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                            <span class="font-medium">${formatDateRange(link.startDate, link.endDate)}</span>
                        </div>
                        ${locationsHTML}
                    </div>
                </div>`;
            return card;
        }

        function generatePageContent() {
            const currentAndUpcomingLinks = [];
            const pastLinks = [];
            for (const link of linksData) {
                const workshopEndDate = new Date(link.endDate + 'T00:00:00');
                if (workshopEndDate >= today) currentAndUpcomingLinks.push(link);
                else pastLinks.push(link);
            }

            if (currentAndUpcomingLinks.length > 0) {
                const currentSection = document.createElement('section');
                currentSection.className = 'year-section';
                currentSection.id = 'current-workshops-section';
                // Use a meaningful heading for the section
                const currentTitle = document.createElement('h2');
                currentTitle.className = 'text-3xl font-bold mb-8 text-gray-800 pl-3 border-l-4 border-green-500';
                currentTitle.textContent = 'Happening Now & Upcoming';
                // Add aria-live region to the grid container if cards within it can change dynamically
                const gridContainer = document.createElement('div');
                gridContainer.className = 'carousel-on-mobile sm:grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 sm:gap-8';
                gridContainer.setAttribute('role', 'region');
                gridContainer.setAttribute('aria-label', 'List of Upcoming and Happening Now Workshops');
                currentAndUpcomingLinks.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                currentAndUpcomingLinks.forEach(link => gridContainer.appendChild(createCardElement(link)));
                currentSection.appendChild(currentTitle);
                currentSection.appendChild(gridContainer);
                linkContainer.insertBefore(currentSection, noResultsMessage);
            }

            const pastLinksByYear = pastLinks.reduce((acc, link) => { (acc[link.year] = acc[link.year] || []).push(link); return acc; }, {});
            const sortedYears = Object.keys(pastLinksByYear).sort((a, b) => b - a);
            let firstPastSectionAssigned = false;
            sortedYears.forEach(year => {
                const yearSection = document.createElement('section');
                yearSection.className = 'year-section';
                if (!firstPastSectionAssigned) { yearSection.id = 'past-workshops-section'; firstPastSectionAssigned = true; }
                const yearTitle = document.createElement('h2');
                yearTitle.className = 'text-3xl font-bold mb-8 text-gray-800 pl-3 border-l-4 border-brand-purple';
                yearTitle.textContent = `${year}`; // More descriptive title
                const gridContainer = document.createElement('div');
                gridContainer.className = 'carousel-on-mobile sm:grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 sm:gap-8';
                gridContainer.setAttribute('role', 'region');
                gridContainer.setAttribute('aria-label', `List of Past Workshops from ${year}`);
                pastLinksByYear[year].forEach(link => gridContainer.appendChild(createCardElement(link)));
                yearSection.appendChild(yearTitle);
                yearSection.appendChild(gridContainer);
                linkContainer.insertBefore(yearSection, noResultsMessage);
            });
        }
        
        function updateFilterCounts() {
            for (const type in allFilters) {
                const count = allFilters[type].active.size;
                const countEl = document.getElementById(`${type}-filter-count`);
                if(countEl) {
                    countEl.textContent = count;
                    countEl.classList.toggle('hidden', count === 0);
                    // Update aria-label for screen reader users
                    const button = countEl.closest('.filter-button');
                    if (button) {
                        if (count > 0) {
                            button.setAttribute('aria-label', `${allFilters[type].label} filter active, ${count} selected`);
                        } else {
                            button.setAttribute('aria-label', `${allFilters[type].label} filter`);
                        }
                    }
                }
            }
        }

        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            let totalVisibleCards = 0;
            noResultsMessage.classList.add('hidden');
            // Announce changes to screen readers when filters are applied
            noResultsMessage.setAttribute('aria-live', 'off'); // Temporarily turn off for filtering
            
            document.querySelectorAll('.card').forEach(card => {
                const searchMatch = !searchTerm || card.dataset.search.includes(searchTerm);
                let filtersMatch = true;
                for (const type in allFilters) {
                    if (allFilters[type].active.size === 0) continue;
                    
                    const cardValues = new Set(JSON.parse(card.dataset[type] || '[]').map(String));

                    if (![...allFilters[type].active].some(filterValue => cardValues.has(filterValue))) {
                        filtersMatch = false;
                        break;
                    }
                }
                if (searchMatch && filtersMatch) {
                    card.classList.remove('hidden');
                    totalVisibleCards++;
                } else {
                    card.classList.add('hidden');
                }
            });
            
            document.querySelectorAll('.year-section').forEach(section => {
                const visibleCards = section.querySelectorAll('.card:not(.hidden)').length;
                section.classList.toggle('hidden', visibleCards === 0);
                // Adjust section heading level if it becomes empty or regains content (less common but good for dynamic views)
            });

            if (totalVisibleCards === 0) {
                noResultsMessage.classList.remove('hidden');
                noResultsMessage.setAttribute('aria-live', 'polite'); // Announce no results
            } else {
                noResultsMessage.setAttribute('aria-live', 'off'); // Turn off if results are back
            }
            updateFilterCounts();
        }

        function generateFilterOptions() {
            const options = {
                year: [...new Set(linksData.map(link => link.year))].sort((a, b) => b - a),
                regions: regionOrder,
                title: [...new Set(linksData.map(link => link.title))].sort(),
                tags: [...new Set(linksData.flatMap(link => link.tags))].sort(),
                format: [...new Set(linksData.map(link => link.format))].sort(),
                status: ["Upcoming", "Happening Now", "Past"]
            };

            for (const type in allFilters) {
                if (options[type] && options[type].length > 0) {
                    const dropdown = document.createElement('div');
                    dropdown.className = 'relative';
                    // Use ARIA attributes for dropdowns: role="combobox", aria-haspopup, aria-expanded, aria-controls
                    const dropdownButtonId = `filter-button-${type}`;
                    const dropdownPanelId = `filter-panel-${type}`;

                    const dropdownPanel = document.createElement('div');
                    dropdownPanel.className = 'dropdown-panel hidden absolute z-10 mt-2 w-56 bg-white rounded-md shadow-2xl border border-gray-200/80 origin-top-right right-0 max-h-60 overflow-y-auto';
                    dropdownPanel.setAttribute('role', 'listbox'); // Indicate it's a list of options
                    dropdownPanel.setAttribute('id', dropdownPanelId);
                    dropdownPanel.setAttribute('aria-labelledby', dropdownButtonId);

                    const checkboxContainer = document.createElement('div');
                    checkboxContainer.className = 'p-2 space-y-1';
                    
                    options[type].forEach(value => {
                        // FIX APPLIED HERE: Convert value to string before .replace()
                        const optionId = `filter-${type}-${String(value).replace(/\s+/g, '-')}`; 
                        const label = document.createElement('label');
                        label.className = 'flex items-center space-x-3 p-2 hover:bg-slate-100 rounded-md cursor-pointer';
                        label.setAttribute('for', optionId); // Link label to input
                        
                        // Add aria-checked for checkboxes
                        label.innerHTML = `
                            <input type="checkbox" id="${optionId}" data-type="${type}" value="${value}" 
                                class="h-4 w-4 rounded border-gray-300 text-brand-purple focus:ring-brand-purple/50">
                            <span class="text-sm text-gray-700 font-medium">${value}</span>
                        `;
                        checkboxContainer.appendChild(label);
                    });
                    
                    dropdownPanel.appendChild(checkboxContainer);
                    dropdown.innerHTML = `
                        <button id="${dropdownButtonId}" class="filter-button bg-white hover:bg-gray-50 text-gray-700 font-semibold py-2.5 px-5 border border-gray-300 rounded-lg shadow-sm flex items-center transition-all duration-200"
                            aria-haspopup="listbox" aria-expanded="false" aria-controls="${dropdownPanelId}">
                            <span>${allFilters[type].label}</span>
                            <span id="${type}-filter-count" class="ml-2 bg-brand-purple text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                            <svg class="dropdown-arrow w-4 h-4 ml-2 text-gray-500 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>`;
                    dropdown.appendChild(dropdownPanel);
                    filterBar.appendChild(dropdown);
                    allFilters[type].container = checkboxContainer;
                }
            }
            const resetButton = document.createElement('button');
            resetButton.id = 'reset-filters-button';
            resetButton.className = 'bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-sm flex items-center transition-all duration-200';
            resetButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h5M20 20v-5h-5M4 9a9 9 0 0114.12-5.12M20 15a9 9 0 01-14.12 5.12" /></svg>Reset Filters`; // More descriptive
            filterBar.appendChild(resetButton);
        }

        function setupInteraction() {
            filterBar.addEventListener('click', e => {
                const button = e.target.closest('.filter-button');
                if (button) {
                    const panel = button.nextElementSibling;
                    const isExpanded = button.getAttribute('aria-expanded') === 'true';

                    // Close all other dropdowns
                    document.querySelectorAll('.dropdown-panel').forEach(p => {
                        p.classList.add('hidden');
                        p.previousElementSibling.setAttribute('aria-expanded', 'false');
                    });
                    
                    // Toggle current dropdown
                    if (!isExpanded) {
                        panel.classList.remove('hidden');
                        button.setAttribute('aria-expanded', 'true');
                    } else {
                        panel.classList.add('hidden');
                        button.setAttribute('aria-expanded', 'false');
                    }
                    return; 
                }
                
                if (e.target.type === 'checkbox') {
                    const type = e.target.dataset.type;
                    const value = e.target.value;
                    if (e.target.checked) allFilters[type].active.add(value);
                    else allFilters[type].active.delete(value);
                    applyFilters();
                    return;
                }

                if(e.target.closest('#reset-filters-button')) {
                    searchInput.value = '';
                    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                    for (const type in allFilters) allFilters[type].active.clear();
                    applyFilters();
                    // Announce reset action
                    const liveRegion = document.createElement('div');
                    liveRegion.setAttribute('aria-live', 'polite');
                    liveRegion.classList.add('sr-only');
                    liveRegion.textContent = 'All filters reset.';
                    document.body.appendChild(liveRegion);
                    setTimeout(() => liveRegion.remove(), 1000);
                }
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', e => {
                if (!e.target.closest('.relative') && !e.target.closest('.dropdown-panel')) {
                    document.querySelectorAll('.dropdown-panel').forEach(p => {
                        p.classList.add('hidden');
                        p.previousElementSibling.setAttribute('aria-expanded', 'false');
                    });
                }
            });

            // Keyboard navigation for dropdowns (Escape to close)
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.dropdown-panel').forEach(p => {
                        p.classList.add('hidden');
                        p.previousElementSibling.setAttribute('aria-expanded', 'false');
                    });
                }
            });

            searchInput.addEventListener('input', applyFilters);
        }

        generatePageContent();
        generateFilterOptions();
        setupInteraction();
        updateFilterCounts();

    } catch (error) {
        console.error("Could not initialize the app:", error);
        document.body.innerHTML = `<div class="text-center p-8"><h2 class="text-xl font-bold text-red-700">A critical error occurred.</h2><p class="mt-2 text-red-500">Could not load or render workshops. Please check the browser console for details.</p></div>`;
    }
});
</script>

<style>
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}
</style>
</body>
</html>