<!DOCTYPE html>
<html lang="en">
<head>
    </head>
<body class="antialiased">
    <div class="container mx-auto my-8 md:my-12">
        <main id="link-container" class="space-y-16">
            </main>
        
        </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // ... initial setup is unchanged ...

                function createCardElement(link) {
                    const card = document.createElement('article');
                    card.className = `card flex flex-col bg-white rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-1 transition-all duration-300 ease-in-out hover:shadow-xl`;
                    card.dataset.tags = JSON.stringify(link.tags);
                    card.dataset.regions = JSON.stringify(link.regions);
                    card.dataset.title = link.title;
                    card.dataset.startDate = link.startDate;
                    card.dataset.endDate = link.endDate; // MODIFICATION #1: Store the end date directly on the card element.
                    card.dataset.format = link.format;
                    
                    // ... the rest of createCardElement is unchanged ...
                    
                    return card;
                }

                // ... generatePageContent and other helpers are unchanged ...

                function applyFilters() {
                    const searchTerm = searchInput.value.toLowerCase().trim();
                    let totalVisibleCards = 0;
                    noResultsMessage.classList.add('hidden');
                    
                    // ... active filter setup is unchanged ...

                    document.querySelectorAll('.year-section').forEach(section => {
                        // ... yearMatch logic is unchanged ...
                        let visibleCardsInSection = 0;

                        section.querySelectorAll('.card').forEach(card => {
                            const originalLink = linksData.find(d => d.title === card.dataset.title && d.startDate === card.dataset.startDate);
                            const searchableText = (originalLink.title + ' ' + originalLink.tags.join(' ') + ' ' + originalLink.location).toLowerCase();
                            const searchMatch = !searchTerm || searchableText.includes(searchTerm);

                            const cardTags = new Set(JSON.parse(card.dataset.tags));
                            const cardRegions = new Set(JSON.parse(card.dataset.regions));
                            const cardTitle = card.dataset.title;
                            const cardFormat = card.dataset.format;
                            const cardStartDate = new Date(card.dataset.startDate + 'T00:00:00');
                            
                            // MODIFICATION #2: Read endDate safely from the card's dataset, removing the failing .find() call.
                            const cardEndDate = new Date(card.dataset.endDate + 'T00:00:00');
                            
                            // ... the rest of the matching logic is unchanged ...
                            
                            let statusMatch = !upcomingChecked && !pastChecked && !nowChecked; 
                            if (nowChecked && cardStartDate <= today && today <= cardEndDate) statusMatch = true;
                            if (upcomingChecked && cardStartDate > today) statusMatch = true;
                            if (pastChecked && cardEndDate < today) statusMatch = true;
                            
                            if (yearMatch && searchMatch && topicMatch && regionMatch && titleMatch && formatMatch && statusMatch) {
                                card.classList.remove('hidden');
                                visibleCardsInSection++;
                            } else {
                                card.classList.add('hidden');
                            }
                        });
                        
                        if (visibleCardsInSection > 0) {
                            section.classList.remove('hidden');
                            totalVisibleCards += visibleCardsInSection;
                        } else {
                            section.classList.add('hidden');
                        }
                    });
                    
                    if (totalVisibleCards === 0) {
                        noResultsMessage.classList.remove('hidden');
                    }
                    
                    updateFilterCounts();
                }
                
                // ... setupInteraction and initialization are unchanged ...

            } catch (error) {
                console.error("Could not initialize the app:", error);
                document.getElementById('link-container').innerHTML = `<p class="text-center text-red-500">Error: Could not load or process workshop data. Please check the console for details.</p>`;
            }
        });
    </script>
</body>
</html>